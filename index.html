<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AUR28 Wallet</title>

  <!-- FAVICON -->
  <link rel="icon" type="image/png" href="favicon.png">

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
      "Segoe UI", sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-size: 14px;
      color: #111827;
      background: radial-gradient(circle at top left, #fef3c7 0, #f9fafb 45%, #eef2ff 100%);
    }

    body.theme-dark {
      background: radial-gradient(circle at top, #020617, #02040d 55%, #000);
      color: #e5e7eb;
    }
    body.theme-light {
      background: radial-gradient(circle at top left, #fef3c7 0, #f9fafb 45%, #eef2ff 100%);
      color: #111827;
    }

    .app-shell {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* SIDEBAR */

    .sidebar {
      width: 260px;
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      padding: 18px 18px 14px;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 22px;
    }

    .sidebar-logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      overflow: hidden;
      background: radial-gradient(circle at 20% 0%, #facc15, #f97316 60%, #f59e0b);
      box-shadow: 0 8px 24px rgba(248, 181, 0, 0.65);
      display: flex;
      align-items: center;
      justify-content-center;
      justify-content: center;
      color: #1f2937;
      font-weight: 800;
      font-size: 16px;
    }
    .sidebar-logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .sidebar-title-block {
      display: flex;
      flex-direction: column;
      line-height: 1.15;
    }
    .sidebar-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #111827;
    }
    .sidebar-subtitle {
      font-size: 11px;
      color: #6b7280;
    }

    .sidebar-section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
      margin-bottom: 6px;
      margin-top: 4px;
    }

    .menu-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 16px;
    }

    .menu-item {
      border: none;
      outline: none;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 7px 11px;
      border-radius: 12px;
      background: transparent;
      cursor: pointer;
      color: #374151;
      font-size: 13px;
      position: relative;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s, color 0.15s;
    }

    .menu-icon {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #fef3c7, #fee2e2);
      border: 1px solid rgba(252, 211, 77, 0.9);
      box-shadow: 0 6px 16px rgba(248, 181, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      overflow: hidden;
    }

    .menu-icon svg {
      width: 16px;
      height: 16px;
      stroke: #f97316;
      stroke-width: 1.7;
      fill: none;
    }

    .menu-item:hover {
      background: #fff7ed;
      color: #111827;
      transform: translateY(-0.5px);
      box-shadow: 0 8px 22px rgba(248, 181, 0, 0.25);
    }

    .menu-item:hover .menu-icon svg {
      stroke: #ea580c;
    }

    .menu-item.active {
      background: linear-gradient(120deg, #f97316, #f59e0b);
      color: #f9fafb;
      box-shadow: 0 14px 30px rgba(248, 181, 0, 0.55);
    }

    .menu-item.active .menu-icon {
      background: radial-gradient(circle at 20% 0%, #fff7ed, #fed7aa);
      border-color: rgba(254, 215, 170, 0.95);
      box-shadow: 0 14px 32px rgba(248, 181, 0, 0.7);
    }

    .menu-item.active .menu-icon svg {
      stroke: #1f2937;
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid #e5e7eb;
      font-size: 11px;
      color: #9ca3af;
    }

    /* MAIN PANEL */

    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      background: transparent;
    }

    .top-bar {
      padding: 10px 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #fde68a;
      background: linear-gradient(90deg, #fffbeb, #fef3c7);
      box-shadow: 0 8px 26px rgba(248, 181, 0, 0.25);
      z-index: 10;
    }

    .top-bar-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .top-title {
      font-size: 16px;
      font-weight: 600;
      color: #111827;
    }
    .top-subtitle {
      font-size: 12px;
      color: #6b7280;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(252, 211, 77, 0.8);
      font-size: 11px;
      background: rgba(254, 243, 199, 0.9);
      color: #92400e;
      white-space: nowrap;
    }
    .chip-accent {
      border-color: rgba(251, 191, 36, 0.9);
      color: #92400e;
    }

    .icon-button {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(252, 211, 77, 0.9);
      background: #fffbeb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      cursor: pointer;
      color: #f97316;
      box-shadow: 0 10px 26px rgba(248, 181, 0, 0.4);
      transition: background 0.15s, transform 0.05s, box-shadow 0.15s;
    }
    .icon-button:hover {
      background: #fde68a;
      transform: translateY(-0.5px);
      box-shadow: 0 14px 36px rgba(248, 181, 0, 0.55);
    }

    .content {
      flex: 1;
      padding: 18px 22px 18px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .view-section {
      width: 100%;
      display: flex;
      gap: 18px;
      min-height: 100%;
    }
    .view-section.hidden {
      display: none;
    }

    .column-left,
    .column-right {
      display: flex;
      flex-direction: column;
      gap: 14px;
      min-width: 0;
    }
    .column-left {
      flex: 1.8;
    }
    .column-right {
      flex: 1;
    }

    .single-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
      min-width: 0;
    }

    .card {
      position: relative;
      border-radius: 18px;
      padding: 16px 18px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      box-shadow: 0 18px 32px rgba(15, 23, 42, 0.06);
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
    }

    .balance {
      margin-top: 6px;
      font-size: 30px;
      font-weight: 600;
      color: #111827;
      word-break: break-word;
    }

    /* NEW: sub-balance rows */
    .balance-sub-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 2px;
      font-size: 12px;
      color: #4b5563;
    }
    .balance-sub-row.pending {
      color: #b45309;
      font-weight: 500;
    }
    .sub-label {
      opacity: 0.9;
    }
    .sub-value {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    .fiat {
      font-size: 13px;
      color: #6b7280;
      margin-top: 4px;
    }

    .address-row {
      margin-top: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }

    .address-box {
      flex: 1;
      padding: 7px 10px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono",
      "Courier New", monospace;
      font-size: 12px;
      color: #111827;
    }

    /* NEW: address list with scroll */
    .address-list-container {
      margin-top: 10px;
      max-height: 120px;
      overflow-y: auto;
      padding: 6px 4px;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .address-list-empty {
      font-size: 11px;
      color: #9ca3af;
      padding: 2px 6px;
    }
    .address-list-item {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      cursor: pointer;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      background: #ffffff;
      border: 1px solid transparent;
    }
    .address-list-item:hover {
      border-color: #fbbf24;
      background: #fffbeb;
    }
    .address-list-item.active {
      background: #fbbf24;
      border-color: #f59e0b;
      color: #111827;
    }

    .pill-btn {
      padding: 7px 11px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fef3c7;
      color: #92400e;
      font-size: 12px;
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.15s, border-color 0.15s, transform 0.05s, box-shadow 0.15s;
    }
    .pill-btn:hover {
      background: #fbbf24;
      border-color: #f59e0b;
      transform: translateY(-0.5px);
      box-shadow: 0 10px 24px rgba(248, 181, 0, 0.45);
      color: #111827;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 8px;
    }

    .tx-list {
      font-size: 12px;
      color: #6b7280;
    }
    .tx-list p {
      margin: 4px 0;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }
    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
    }

    .field-inline {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .field-inline input {
      flex: 1;
    }
    .field-inline .pill-btn {
      flex-shrink: 0;
    }

    input,
    textarea {
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      color: #111827;
      padding: 8px 10px;
      font-size: 13px;
    }
    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
    }
    textarea {
      resize: vertical;
      min-height: 56px;
    }

    .primary-btn {
      width: 100%;
      padding: 10px 16px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #f97316, #f59e0b);
      color: #f9fafb;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      margin-top: 6px;
      box-shadow: 0 16px 40px rgba(248, 181, 0, 0.6);
      transition: filter 0.15s, transform 0.05s;
    }
    .primary-btn:hover {
      filter: brightness(1.05);
      transform: translateY(-0.5px);
    }

    .status-text {
      font-size: 12px;
      color: #6b7280;
    }

    .footer {
      padding: 8px 22px 10px;
      font-size: 11px;
      color: #9ca3af;
      border-top: 1px solid #fde68a;
      background: linear-gradient(90deg, #fffbeb, #fef3c7);
    }

    .chart-placeholder {
      margin-top: 14px;
      height: 120px;
      border-radius: 14px;
      background: linear-gradient(180deg, #bfdbfe, #eff6ff);
      position: relative;
      overflow: hidden;
    }
    .chart-grid-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 1px;
      background: rgba(148, 163, 184, 0.5);
      opacity: 0.35;
    }
    .chart-grid-line:nth-child(1) { left: 15%; }
    .chart-grid-line:nth-child(2) { left: 35%; }
    .chart-grid-line:nth-child(3) { left: 55%; }
    .chart-grid-line:nth-child(4) { left: 75%; }

    /* GLOBAL MARKET CARD */
    .market-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .market-last-update {
      font-size: 10px;
      color: #9ca3af;
    }
    .market-rows {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }
    .market-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .market-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .market-badge {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 0% 0%, #bfdbfe, #eff6ff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: #1f2937;
      box-shadow: 0 6px 14px rgba(148, 163, 184, 0.6);
    }
    .market-symbol {
      font-weight: 600;
      color: #111827;
    }
    .market-name {
      font-size: 11px;
      color: #6b7280;
    }
    .market-right {
      text-align: right;
    }
    .market-price {
      font-weight: 500;
      color: #111827;
    }
    .market-change {
      font-size: 11px;
    }
    .market-change.pos {
      color: #16a34a;
    }
    .market-change.neg {
      color: #ef4444;
    }
    .market-change.flat {
      color: #6b7280;
    }

    /* AUTH OVERLAY ‚Äì NEW LIGHT STYLE TO MATCH DASHBOARD */

    .welcome-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top left, #fef3c7 0, #f9fafb 45%, #eef2ff 100%);
      z-index: 50;
      backdrop-filter: blur(10px);
    }
    .welcome-card {
      width: 430px;
      max-width: 94vw;
      background: rgba(255, 255, 255, 0.96);
      border-radius: 22px;
      padding: 22px 22px 18px;
      border: 1px solid rgba(226, 232, 240, 0.9);
      box-shadow: 0 26px 80px rgba(15, 23, 42, 0.25);
      color: #111827;
    }
    .welcome-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .welcome-title {
      font-size: 18px;
      font-weight: 600;
    }
    .welcome-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: #f9fafb;
      color: #6b7280;
    }
    .welcome-sub {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 12px;
    }
    .welcome-tabs {
      display: inline-flex;
      border-radius: 999px;
      padding: 2px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: #f9fafb;
      margin-bottom: 14px;
    }
    .welcome-tab {
      border-radius: 999px;
      border: none;
      padding: 6px 16px;
      font-size: 12px;
      cursor: pointer;
      background: transparent;
      color: #6b7280;
      transition: background 0.15s, color 0.15s, box-shadow 0.15s;
    }
    .welcome-tab.active {
      background: #ffffff;
      color: #111827;
      box-shadow: 0 8px 24px rgba(148, 163, 184, 0.6);
    }
    .welcome-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .welcome-input {
      width: 100%;
      margin-bottom: 8px;
      padding: 8px 10px;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      color: #111827;
      font-size: 13px;
    }
    .welcome-input::placeholder {
      color: #9ca3af;
    }
    .password-strength {
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      margin-top: 2px;
      overflow: hidden;
    }
    .password-strength-inner {
      height: 100%;
      width: 0%;
      background: #22c55e;
      transition: width 0.2s, background 0.2s;
    }
    .password-strength-label {
      font-size: 10px;
      margin-top: 2px;
      color: #6b7280;
    }
    .welcome-btn {
      width: 100%;
      padding: 9px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #f9fafb;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      margin-top: 6px;
      box-shadow: 0 18px 48px rgba(22, 163, 74, 0.4);
    }
    .welcome-hint {
      font-size: 10px;
      color: #6b7280;
      margin-top: 8px;
    }
    .welcome-link {
      font-size: 11px;
      color: #2563eb;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 8px;
    }

    .otp-row {
      margin-top: 6px;
    }

    /* SETTINGS PANEL */

    .settings-backdrop {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top,
      rgba(15, 23, 42, 0.9),
      rgba(15, 23, 42, 0.95));
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }
    .settings-backdrop.open {
      display: flex;
    }

    .settings-panel {
      width: min(640px, 94vw);
      max-height: 86vh;
      border-radius: 22px;
      background: radial-gradient(circle at top left,
      rgba(15, 23, 42, 0.98),
      rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(55, 65, 81, 0.95);
      padding: 16px 18px 18px;
      box-shadow: 0 26px 80px rgba(0, 0, 0, 0.96);
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      backdrop-filter: blur(20px);
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .settings-title-main {
      font-size: 15px;
      font-weight: 600;
    }
    .settings-title-sub {
      font-size: 12px;
      color: #9ca3af;
    }

    .settings-section {
      padding: 11px 12px;
      border-radius: 18px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      background: radial-gradient(circle at top left,
      rgba(15, 23, 42, 0.98),
      rgba(15, 23, 42, 0.96));
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .settings-section h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 600;
    }

    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .set-chip {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s, box-shadow 0.15s, transform 0.05s;
    }
    .set-chip:hover {
      background: rgba(30, 64, 175, 0.9);
      border-color: rgba(129, 140, 248, 0.9);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.95);
      transform: translateY(-0.5px);
    }
    .set-chip.active {
      background: linear-gradient(135deg, #1d4ed8, #4f46e5);
      border-color: rgba(191, 219, 254, 0.9);
      box-shadow: 0 18px 48px rgba(37, 99, 235, 0.9);
    }

    .settings-hint {
      font-size: 11px;
      color: #9ca3af;
      margin: 0;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 10px;
    }
    .settings-card {
      padding: 9px 11px;
      border-radius: 16px;
      border: 1px dashed rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.96);
      font-size: 11px;
      color: #9ca3af;
    }
    .settings-card-title {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 2px;
      color: #e5e7eb;
    }

    @media (max-width: 960px) {
      .app-shell {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        align-items: center;
        width: 100%;
        height: auto;
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
      }
      .sidebar-header {
        margin-bottom: 0;
        margin-right: 16px;
      }
      .sidebar-section-label {
        display: none;
      }
      .menu-list {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .sidebar-footer {
        display: none;
      }
      .content {
        flex-direction: column;
      }
    }

    /* SIMPLE CUSTOM CONTEXT MENU FOR COPY/PASTE */

    #context-menu {
      position: fixed;
      z-index: 9999;
      min-width: 120px;
      background: #ffffff;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.3);
      font-size: 12px;
      padding: 4px 0;
      display: none;
    }
    #context-menu button {
      width: 100%;
      padding: 6px 12px;
      background: transparent;
      border: none;
      text-align: left;
      cursor: pointer;
      font-size: 12px;
      color: #374151;
    }
    #context-menu button:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body class="theme-light">

<!-- AUTH OVERLAY -->
<div class="welcome-overlay" id="welcome-overlay">
  <div class="welcome-card">
    <div class="welcome-header-row">
      <div class="welcome-title">AUR28 Wallet</div>
      <div class="welcome-badge">Desktop App</div>
    </div>
    <div class="welcome-sub" id="welcome-sub">
      Create a new wallet account to start using your Aurum28 desktop wallet.
    </div>

    <div class="welcome-tabs">
      <button class="welcome-tab active" id="tab-signup">Sign up</button>
      <button class="welcome-tab" id="tab-login">Log in</button>
    </div>

    <div>
      <div class="welcome-label">Email</div>
      <input id="welcome-email" class="welcome-input" type="email" placeholder="you@example.com" />

      <div class="welcome-label">Password</div>
      <input id="welcome-password" class="welcome-input" type="password" placeholder="********" />

      <div id="password-strength-wrap">
        <div class="password-strength">
          <div class="password-strength-inner" id="password-strength-inner"></div>
        </div>
        <div class="password-strength-label" id="password-strength-label">Password strength: -</div>
      </div>

      <div id="confirm-password-wrap">
        <div class="welcome-label">Confirm password</div>
        <input id="welcome-password-confirm" class="welcome-input" type="password" placeholder="Repeat password" />
      </div>

      <div class="otp-row" id="otp-row" style="display:none;">
        <div class="welcome-label">Email OTP</div>
        <input id="welcome-otp" class="welcome-input" type="text" placeholder="6-digit code" />
      </div>

      <button class="welcome-btn" id="welcome-continue">Continue</button>

      <div class="welcome-hint" id="welcome-hint">
        Enter your email + password, then you will receive a 6-digit code from info@aurum28.org.
      </div>

      <div class="welcome-link" id="forgot-link">
        Forgot password?
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div class="settings-backdrop" id="settings-backdrop">
  <div class="settings-panel">
    <div class="settings-header">
      <div>
        <div class="settings-title-main">Wallet settings</div>
        <div class="settings-title-sub">Personalise your AUR28 desktop wallet</div>
      </div>
      <button class="icon-button" id="settings-close" type="button">‚úï</button>
    </div>

    <div class="settings-section">
      <h3>Appearance</h3>
      <div class="settings-row">
        <button class="set-chip" data-group="theme" data-value="dark">Dark</button>
        <button class="set-chip" data-group="theme" data-value="light">Light</button>
        <button class="set-chip" data-group="theme" data-value="auto">System</button>
      </div>
      <p class="settings-hint">Choose dark, light, or follow your computer‚Äôs system preference.</p>
    </div>

    <div class="settings-section">
      <h3>Language</h3>
      <div class="settings-row">
        <button class="set-chip" data-group="lang" data-value="en">English</button>
        <button class="set-chip" data-group="lang" data-value="ka">·É•·Éê·É†·Éó·É£·Éö·Éò</button>
        <button class="set-chip" data-group="lang" data-value="tr">T√ºrk√ße</button>
        <button class="set-chip" data-group="lang" data-value="ja">Êó•Êú¨Ë™û</button>
      </div>
      <p class="settings-hint">
        Selected language: <span id="lang-current">English</span>. Text translation will be connected later.
      </p>
    </div>

    <div class="settings-section">
      <h3>Text size</h3>
      <div class="settings-row">
        <button class="set-chip" data-group="text" data-value="small">Small</button>
        <button class="set-chip" data-group="text" data-value="default">Default</button>
        <button class="set-chip" data-group="text" data-value="large">Large</button>
      </div>
      <p class="settings-hint">Adjust for comfortable reading on your display.</p>
    </div>

    <div class="settings-section">
      <h3>System overview</h3>
      <div class="settings-grid">
        <div class="settings-card">
          <div class="settings-card-title">Computer status</div>
          <div id="device-info">Detecting device‚Ä¶</div>
        </div>
        <div class="settings-card">
          <div class="settings-card-title">AURUM server</div>
          <div id="server-info">Checking connection‚Ä¶</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div class="app-shell">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">
        <!-- USE YOUR DESKTOP LOGO: logo.png -->
        <img src="logo.png" alt="AUR28 Logo"
             onerror="this.style.display='none'; this.parentNode.textContent='A';" />
      </div>
      <div class="sidebar-title-block">
        <div class="sidebar-title">AUR28</div>
        <div class="sidebar-subtitle">Desktop wallet</div>
      </div>
    </div>

    <div class="sidebar-section-label">Wallet</div>
    <div class="menu-list">
      <button class="menu-item active" data-section="wallet">
        <span class="menu-icon">
          <!-- Wallet icon -->
          <svg viewBox="0 0 24 24">
            <path d="M4 7.5h12.5a2 2 0 0 1 2 2V17a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9.5a2 2 0 0 1 2-2Z" />
            <path d="M16.5 10h3.5v6h-3.5" />
            <circle cx="16.8" cy="13" r="0.9" />
          </svg>
        </span>
        <span>My wallet</span>
      </button>

      <button class="menu-item" data-section="account">
        <span class="menu-icon">
          <!-- User / account icon -->
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="9" r="3.2" />
            <path d="M5 19.5c0-3.2 3-5.5 7-5.5s7 2.3 7 5.5" />
          </svg>
        </span>
        <span>Account</span>
      </button>

      <button class="menu-item" data-section="market">
        <span class="menu-icon">
          <!-- Market / chart icon -->
          <svg viewBox="0 0 24 24">
            <path d="M4 18.5h16" />
            <path d="M6 18.5V11l3.5-2.5 3.5 3 5-5" />
            <path d="M16.8 6h3.2v3.2" />
          </svg>
        </span>
        <span>Market preview</span>
      </button>
    </div>

    <div class="sidebar-section-label">Support</div>
    <div class="menu-list">
      <button class="menu-item" data-section="contact">
        <span class="menu-icon">
          <!-- Mail / chat icon -->
          <svg viewBox="0 0 24 24">
            <path d="M4.5 6.5h15v9h-9.2L7 19.5v-4" />
            <path d="M5.5 8l6.5 4.5L18.5 8" />
          </svg>
        </span>
        <span>Contact admin</span>
      </button>

      <button class="menu-item" data-section="settings">
        <span class="menu-icon">
          <!-- Settings / gear icon -->
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="2.3" />
            <path d="M6.4 9.2 5 7.2l1.6-2.7 2.5.5a5.7 5.7 0 0 1 1.9-1.1L11.4 2h3.2l.4 1.9a5.7 5.7 0 0 1 1.9 1.1l2.5-.5L21 7.2l-1.4 2a5.5 5.5 0 0 1 0 1.7l1.4 2-1.6 2.7-2.5-.5a5.7 5.7 0 0 1-1.9 1.1L14.6 22h-3.2l-.4-1.9a5.7 5.7 0 0 1-1.9-1.1l-2.5.5L4 15.9l1.4-2a5.5 5.5 0 0 1 0-1.7Z" />
          </svg>
        </span>
        <span>Settings</span>
      </button>
    </div>

    <div class="sidebar-footer">
      <div>AUR28 Wallet ‚Ä¢ Desktop application</div>
    </div>
  </aside>

  <!-- MAIN PANEL -->
  <main class="main-panel">
    <header class="top-bar">
      <div class="top-bar-left">
        <div class="top-title">AUR28 Wallet</div>
        <div class="top-subtitle" id="top-subtitle">My wallet</div>
      </div>
      <div class="top-bar-right">
        <div class="chip chip-accent" id="market-countdown">Listing countdown‚Ä¶</div>
        <button class="icon-button" id="logout-top-btn" type="button" title="Logout">üîì</button>
        <button class="icon-button" id="settings-btn" type="button" title="Wallet settings">‚öô</button>
      </div>
    </header>

    <section class="content">
      <!-- WALLET VIEW -->
      <div id="view-wallet" class="view-section">
        <div class="column-left">
          <div class="card">
            <div class="card-header-row">
              <div>
                <div class="label">Total balance</div>
                <!-- MAIN TOTAL (confirmed + mempool / pending) -->
                <div class="balance" id="balance-aur" data-balance-total>0.000000 AUR28</div>

                <!-- CONFIRMED + PENDING ROWS -->
                <div class="balance-sub-row">
                  <span class="sub-label">Confirmed</span>
                  <span class="sub-value" data-balance-confirmed>0.000000 AUR28</span>
                </div>
                <div class="balance-sub-row pending" data-balance-pending-wrapper style="display:none;">
                  <span class="sub-label">Pending (unconfirmed)</span>
                  <span class="sub-value" data-balance-pending>0.000000 AUR28</span>
                </div>

                <div class="fiat" id="balance-fiat">‚âà $0.00 USD (preview)</div>
              </div>
            </div>

            <div class="address-row">
              <div class="address-box" id="main-address">
                No address generated yet. Click "Generate" to get your AUR28 deposit address.
              </div>
              <button class="pill-btn" id="copy-address">Copy</button>
              <button class="pill-btn" id="generate-address">Generate</button>
            </div>

            <!-- NEW: address list -->
            <div class="address-list-container">
              <div id="address-list" class="address-list-empty">
                No previous addresses yet. Generate to create your first AUR28 address.
              </div>
            </div>

            <div class="chart-placeholder">
              <div class="chart-grid-line"></div>
              <div class="chart-grid-line"></div>
              <div class="chart-grid-line"></div>
              <div class="chart-grid-line"></div>
            </div>
          </div>

          <div class="card">
            <div class="section-title">Recent activity</div>
            <div class="tx-list" id="tx-list">
              <p>Transaction history integration will be added in the next update.</p>
            </div>
          </div>
        </div>

        <div class="column-right">
          <div class="card">
            <div class="section-title">Send AUR28</div>
            <div class="field-group">
              <div class="field-label">To address</div>
              <input id="send-to" placeholder="aur1q‚Ä¶" />
            </div>
            <div class="field-group">
              <div class="field-label">Amount (AUR28)</div>
              <input id="send-amount" placeholder="0.000000" />
            </div>
            <div class="field-group">
              <div class="field-label">Note (optional)</div>
              <textarea id="send-note" placeholder="For your own records"></textarea>
            </div>
            <button class="primary-btn" id="send-btn">Send (not connected)</button>
          </div>

          <div class="card">
            <div class="section-title">Status</div>
            <div class="status-text" id="status-box">
              Sign up or log in first, then click "Generate" to get your AUR28 address.
            </div>
          </div>
        </div>
      </div>

      <!-- ACCOUNT VIEW -->
      <div id="view-account" class="view-section hidden">
        <div class="single-column">
          <div class="card">
            <div class="section-title" id="account-title">Account &amp; security</div>

            <div class="field-group">
              <div class="field-label">Email</div>
              <input id="account-email" placeholder="you@example.com" disabled />
            </div>

            <div class="field-group">
              <div class="field-label">Password</div>
              <input value="********" disabled />
            </div>

            <div class="field-group">
              <div class="field-label">Last change</div>
              <input id="account-last-change" value="Not available (local demo)" disabled />
            </div>

            <div class="field-group">
              <div class="field-label">Security code</div>
              <div class="field-inline">
                <input id="account-sec-code" placeholder="Not created yet" readonly />
                <button type="button" class="pill-btn" id="sec-generate">New</button>
                <button type="button" class="pill-btn" id="sec-copy">Copy</button>
              </div>
            </div>

            <div class="field-group">
              <div class="field-label">API token</div>
              <div class="field-inline">
                <input id="account-api-token" placeholder="Not created yet" readonly />
                <button type="button" class="pill-btn" id="token-generate">New</button>
                <button type="button" class="pill-btn" id="token-copy">Copy</button>
              </div>
            </div>

            <div class="status-text">
              Security code and API token are stored only on this computer (local demo).
              In the future, they can be used to connect your wallet to global markets
              when AUR28 / FAB28 is listed.
            </div>

            <div class="field-group" style="margin-top:10px;">
              <div class="field-label">Logout</div>
              <button type="button" class="pill-btn" id="logout-btn">Log out from this device</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MARKET VIEW -->
      <div id="view-market" class="view-section hidden">
        <div class="single-column">
          <div class="card">
            <div class="section-title" id="aur28-market-title">AUR28 market preview</div>
            <div class="status-text">
              AUR28 is preparing for listing. Countdown above shows the planned market listing date.
            </div>
          </div>

          <div class="card">
            <div class="market-header-row">
              <div class="section-title" id="global-market-title">Global crypto market</div>
              <div class="market-last-update" id="market-last-update">Updating‚Ä¶</div>
            </div>
            <div class="market-rows" id="market-rows"></div>
            <div class="status-text" id="market-status" style="margin-top:8px;">
              Live BTC / ETH / XRP from public API. AUR28 is preview only.
            </div>
          </div>
        </div>
      </div>

      <!-- CONTACT VIEW -->
      <div id="view-contact" class="view-section hidden">
        <div class="single-column">
          <div class="card">
            <div class="section-title" id="contact-title">Contact admin</div>

            <div class="field-group">
              <div class="field-label" id="contact-name-label">Your name</div>
              <input id="contact-name" placeholder="Full name" />
            </div>

            <div class="field-group">
              <div class="field-label" id="contact-email-label">Email</div>
              <input id="contact-email" placeholder="you@example.com" />
            </div>

            <div class="field-group">
              <div class="field-label" id="contact-message-label">Message</div>
              <textarea id="contact-message" placeholder="Describe your issue or request"></textarea>
            </div>

            <button class="primary-btn" id="contact-send">Send to admin (not connected)</button>
            <div class="status-text" id="contact-status">
              In the live version, this form will send directly to the AUR28 admin dashboard.
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="footer">
      AUR28 Wallet ‚Ä¢ Desktop edition
    </footer>
  </main>
</div>

<!-- CUSTOM CONTEXT MENU -->
<div id="context-menu">
  <button type="button" data-action="copy">Copy</button>
  <button type="button" data-action="paste">Paste</button>
  <button type="button" data-action="select-all">Select all</button>
</div>

<script>
  // CONFIG
  const config = (window.aur28 && window.aur28.config) || {
    apiBaseUrl: "https://wallet.aurum28.org",
    network: "AUR28-Mainnet",
    demoMode: false,
  };

  // COUNTDOWN
  (function setupCountdown() {
    const el = document.getElementById("market-countdown");
    if (!el) return;
    const target = new Date(2026, 1, 28, 0, 0, 0); // 28 Feb 2026

    function updateCountdown() {
      const now = new Date();
      const diff = target.getTime() - now.getTime();
      if (diff <= 0) {
        el.textContent = "Market listing live";
        return;
      }
      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / (24 * 3600));
      const hours = Math.floor((totalSeconds % (24 * 3600)) / 3600);
      const mins = Math.floor((totalSeconds % 3600) / 60);
      const secs = totalSeconds % 60;

      el.textContent =
        "Market listing in " +
        days + "d " +
        String(hours).padStart(2, "0") + "h " +
        String(mins).padStart(2, "0") + "m " +
        String(secs).padStart(2, "0") + "s";
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);
  })();

  const statusBox = document.getElementById("status-box");
  if (statusBox) {
    statusBox.innerText = "Connected server: " + config.apiBaseUrl;
  }

  let authToken = null;
  let currentEmail = null;
  let activeAddress = null;

  // Per-user meta (security code + API token) stored locally
  let userMeta = {};
  // NEW: list of all addresses
  let addressList = [];

  function loadUserMeta() {
    try {
      userMeta = JSON.parse(localStorage.getItem("aur28_user_meta")) || {};
    } catch (e) {
      userMeta = {};
    }
  }

  function saveUserMeta() {
    try {
      localStorage.setItem("aur28_user_meta", JSON.stringify(userMeta));
    } catch (e) {}
  }

  function loadAddressList() {
    try {
      addressList = JSON.parse(localStorage.getItem("aur28_address_list")) || [];
    } catch (e) {
      addressList = [];
    }
  }

  function saveAddressList() {
    try {
      localStorage.setItem("aur28_address_list", JSON.stringify(addressList));
    } catch (e) {}
  }

  loadUserMeta();
  loadAddressList();

  function randomDigits(len) {
    let out = "";
    for (let i = 0; i < len; i++) {
      out += Math.floor(Math.random() * 10).toString();
    }
    return out;
  }

  function randomHex(len) {
    const hex = "abcdef0123456789";
    let out = "";
    for (let i = 0; i < len; i++) {
      out += hex[Math.floor(Math.random() * hex.length)];
    }
    return out;
  }

  function buildUrl(path) {
    const base = (config.apiBaseUrl || "").replace(/\/+$/, "");
    return base + path;
  }

  async function apiRequest(path, options = {}) {
    const url = buildUrl(path);
    const headers = Object.assign(
      { "Content-Type": "application/json" },
      options.headers || {}
    );
    if (authToken) {
      headers["Authorization"] = `Bearer ${authToken}`;
    }
    const resp = await fetch(url, { ...options, headers });
    let data = null;
    try {
      data = await resp.json();
    } catch (e) {
      // Non-JSON or empty
    }
    if (!resp.ok) {
      const msg =
        (data && (data.detail || data.error || data.message)) ||
        `HTTP ${resp.status}`;
      throw new Error(msg);
    }
    return data;
  }

  const mainAddressEl = document.getElementById("main-address");
  const balanceAurEl = document.getElementById("balance-aur");
  const balanceFiatEl = document.getElementById("balance-fiat");
  const txListEl = document.getElementById("tx-list");
  const accountSecInput = document.getElementById("account-sec-code");
  const accountTokenInput = document.getElementById("account-api-token");
  const addressListEl = document.getElementById("address-list");

  // NEW: sub-balance elements
  const balTotalEl = document.querySelector("[data-balance-total]");
  const balConfirmedEl = document.querySelector("[data-balance-confirmed]");
  const balPendingWrapper = document.querySelector("[data-balance-pending-wrapper]");
  const balPendingEl = document.querySelector("[data-balance-pending]");

  // Helper: nice AUR28 formatting (2.1 instead of 2.100000)
  function formatAUR(amount) {
    const num = Number(amount || 0);
    return num.toFixed(6).replace(/\.?0+$/, "");
  }

  function renderAddressList() {
    if (!addressListEl) return;
    if (!addressList || addressList.length === 0) {
      addressListEl.className = "address-list-empty";
      addressListEl.textContent =
        'No previous addresses yet. Generate to create your first AUR28 address.';
      return;
    }
    addressListEl.className = "";
    addressListEl.innerHTML = "";
    addressList.forEach((addr) => {
      const item = document.createElement("div");
      item.className =
        "address-list-item" + (addr === activeAddress ? " active" : "");
      item.textContent = addr;
      item.addEventListener("click", () => {
        setActiveAddress(addr);
        loadWallet();
      });
      addressListEl.appendChild(item);
    });
  }

  function setActiveAddress(addr) {
    activeAddress = addr || null;
    if (mainAddressEl) {
      mainAddressEl.innerText =
        addr ||
        'No address generated yet. Click "Generate" to get your AUR28 deposit address.';
    }
    try {
      if (addr) {
        localStorage.setItem("aur28_active_address", addr);
      } else {
        localStorage.removeItem("aur28_active_address");
      }
    } catch (e) {}
    renderAddressList();
  }

  // Restore saved address
  try {
    const saved = localStorage.getItem("aur28_active_address");
    if (saved) {
      activeAddress = saved;
    }
  } catch (e) {}
  renderAddressList();
  if (activeAddress) {
    setActiveAddress(activeAddress);
  }

  // FINAL: loadWallet using plain fetch (no auth) + address recovery
  async function loadWallet() {
    if (!statusBox) return;

    // 1) Recover address if needed
    if (!activeAddress) {
      if (mainAddressEl) {
        const txt = (mainAddressEl.innerText || "").trim();
        if (txt && !txt.startsWith("No address")) {
          activeAddress = txt;
        }
      }
      if (!activeAddress) {
        try {
          const saved = localStorage.getItem("aur28_active_address");
          if (saved) activeAddress = saved;
        } catch (e) {}
      }
    }

    // Still no address ‚Üí show zero state
    if (!activeAddress) {
      statusBox.innerText =
        'No deposit address yet. Click "Generate" to create your AUR28 address.';
      if (balTotalEl) balTotalEl.textContent = "0 AUR28";
      if (balConfirmedEl) balConfirmedEl.textContent = "0 AUR28";
      if (balPendingWrapper && balPendingEl) {
        balPendingWrapper.style.display = "none";
        balPendingEl.textContent = "0 AUR28";
      }
      if (balanceFiatEl) balanceFiatEl.textContent = "‚âà $0.00 USD (preview)";
      return;
    }

    statusBox.innerText = "Loading wallet data‚Ä¶";

    try {
      const url = buildUrl(`/walletbal?addr=${encodeURIComponent(activeAddress)}`);

      // Plain fetch (no Authorization, no extra headers) to avoid CORS preflight issues
      const resp = await fetch(url);
      if (!resp.ok) {
        throw new Error(`HTTP ${resp.status}`);
      }

      let balData;
      try {
        balData = await resp.json();
      } catch (e) {
        throw new Error("Invalid JSON from /walletbal");
      }

      const confirmed = Number(balData?.confirmed ?? 0);
      const immature = Number(balData?.immature ?? 0);
      const mempoolIn = Number(balData?.mempool_in ?? 0);

      let effectiveTotal;
      if (balData?.effective_total != null) {
        effectiveTotal = Number(balData.effective_total);
      } else if (balData?.total != null) {
        effectiveTotal = Number(balData.total) + mempoolIn;
      } else {
        effectiveTotal = confirmed + immature + mempoolIn;
      }

      let pending = effectiveTotal - confirmed;
      if (pending < 0) pending = 0;

      // Update UI
      const totalText = `${formatAUR(effectiveTotal)} AUR28`;
      if (balTotalEl) {
        balTotalEl.textContent = totalText;
      } else if (balanceAurEl) {
        balanceAurEl.innerText = totalText;
      }

      if (balConfirmedEl) {
        balConfirmedEl.textContent = `${formatAUR(confirmed)} AUR28`;
      }

      if (balPendingWrapper && balPendingEl) {
        if (pending > 0.00000001) {
          balPendingWrapper.style.display = "flex";
          balPendingEl.textContent = `${formatAUR(pending)} AUR28`;
        } else {
          balPendingWrapper.style.display = "none";
          balPendingEl.textContent = "0 AUR28";
        }
      }

      // NEW: 2.30 USD per AUR28
      if (balanceFiatEl) {
        const usd = effectiveTotal * 2.3;
        balanceFiatEl.innerText =
          "‚âà $" +
          usd.toLocaleString(undefined, {
            maximumFractionDigits: 2,
          }) +
          " USD (AUR28 @ $2.30)";
      }

      if (txListEl) {
        txListEl.innerHTML =
          "<p>Transaction history integration will be added in the next update.</p>";
      }

      if (pending > 0.00000001) {
        statusBox.innerText =
          `Verifying on the network‚Ä¶ Your recent AUR28 deposit (${formatAUR(
            pending
          )} AUR28) is waiting for confirmation.`;
      } else {
        statusBox.innerText = `Wallet loaded for ${activeAddress}.`;
      }
    } catch (err) {
      statusBox.innerText = "Could not load wallet data: " + err.message;
    }
  }

  async function ensureAddress() {
    if (!authToken) {
      statusBox.innerText = "Please sign up or log in first.";
      return;
    }
    statusBox.innerText = "Generating your AUR28 deposit address‚Ä¶";
    try {
      const addrData = await apiRequest("/public/address", { method: "GET" });
      const addr =
        (addrData && (addrData.address || addrData.addr || addrData.result)) ||
        null;
      if (!addr) {
        statusBox.innerText =
          "Could not read address from server response. Please check /public/address implementation.";
        return;
      }

      // Add to address list (newest on top)
      if (!addressList.includes(addr)) {
        addressList.unshift(addr);
        saveAddressList();
      }
      setActiveAddress(addr);

      statusBox.innerText = "Deposit address generated. Loading balance‚Ä¶";
      await loadWallet();
    } catch (err) {
      statusBox.innerText = "Address generation error: " + err.message;
    }
  }

  // AUTH UI
  const welcomeOverlay = document.getElementById("welcome-overlay");
  const welcomeEmail = document.getElementById("welcome-email");
  const welcomePassword = document.getElementById("welcome-password");
  const welcomePasswordConfirm = document.getElementById("welcome-password-confirm");
  const passwordStrengthInner = document.getElementById("password-strength-inner");
  const passwordStrengthLabel = document.getElementById("password-strength-label");
  const welcomeButton = document.getElementById("welcome-continue");
  const welcomeSub = document.getElementById("welcome-sub");
  const welcomeHint = document.getElementById("welcome-hint");
  const tabSignup = document.getElementById("tab-signup");
  const tabLogin = document.getElementById("tab-login");
  const otpRow = document.getElementById("otp-row");
  const forgotLink = document.getElementById("forgot-link");
  const confirmPasswordWrap = document.getElementById("confirm-password-wrap");
  const passwordStrengthWrap = document.getElementById("password-strength-wrap");
  const accountEmailInput = document.getElementById("account-email");

  function applyUserMeta() {
    if (!currentEmail) {
      if (accountSecInput) accountSecInput.value = "";
      if (accountTokenInput) accountTokenInput.value = "";
      return;
    }
    const meta = userMeta[currentEmail] || {};
    if (accountSecInput) {
      accountSecInput.value = meta.secCode || "";
    }
    if (accountTokenInput) {
      accountTokenInput.value = meta.apiToken || "";
    }
  }

  try {
    const savedToken = localStorage.getItem("token");
    const savedEmail = localStorage.getItem("aur28_last_email");
    if (savedToken) {
      authToken = savedToken;
      if (savedEmail) {
        currentEmail = savedEmail;
        if (accountEmailInput) {
          accountEmailInput.value = currentEmail;
        }
      }
      if (welcomeOverlay) welcomeOverlay.style.display = "none";
      if (statusBox) {
        statusBox.innerText =
          'Logged in from desktop login. Click "Generate" to get your AUR28 deposit address.';
      }
      applyUserMeta();
    }
  } catch (e) {}

  let authMode = "signup"; // "signup" or "login"
  let signupStep = "collect"; // "collect" -> "code-sent" for signup OTP
  let forgotMode = false;

  function evaluatePasswordStrength(pw) {
    let score = 0;
    if (pw.length >= 8) score++;
    if (/[A-Z]/.test(pw)) score++;
    if (/[0-9]/.test(pw)) score++;
    if (/[^A-Za-z0-9]/.test(pw)) score++;

    let pct = 0;
    let label = "Password strength: -";
    let color = "#374151";

    if (pw.length === 0) {
      pct = 0;
      label = "Password strength: -";
    } else if (score <= 1) {
      pct = 30;
      label = "Password strength: weak";
      color = "#ef4444";
    } else if (score === 2 || score === 3) {
      pct = 65;
      label = "Password strength: medium";
      color = "#f97316";
    } else {
      pct = 100;
      label = "Password strength: strong";
      color = "#22c55e";
    }

    if (passwordStrengthInner && passwordStrengthLabel) {
      passwordStrengthInner.style.width = pct + "%";
      passwordStrengthInner.style.background = color;
      passwordStrengthLabel.innerText = label;
    }
  }

  if (welcomePassword) {
    welcomePassword.addEventListener("input", () => {
      evaluatePasswordStrength(welcomePassword.value);
    });
  }

  function setMode(mode) {
    authMode = mode;
    forgotMode = false;
    signupStep = "collect";

    if (otpRow) otpRow.style.display = "none";

    if (welcomePassword) welcomePassword.value = "";
    if (welcomePasswordConfirm) welcomePasswordConfirm.value = "";

    if (passwordStrengthInner && passwordStrengthLabel) {
      passwordStrengthInner.style.width = "0%";
      passwordStrengthInner.style.background = "#22c55e";
      passwordStrengthLabel.innerText = "Password strength: -";
    }

    if (mode === "signup") {
      if (tabSignup) tabSignup.classList.add("active");
      if (tabLogin) tabLogin.classList.remove("active");
      if (confirmPasswordWrap) confirmPasswordWrap.style.display = "block";
      if (passwordStrengthWrap) passwordStrengthWrap.style.display = "block";
      if (welcomeSub)
        welcomeSub.innerText =
          "Create a new wallet account and verify your email to use your Aurum28 desktop wallet.";
      if (welcomeButton) welcomeButton.innerText = "Send code";
      if (welcomeHint)
        welcomeHint.innerText =
          "Enter your email + password and click 'Send code'. A 6-digit OTP will be sent from info@aurum28.org.";
      if (forgotLink) forgotLink.style.display = "none";
    } else {
      if (tabLogin) tabLogin.classList.add("active");
      if (tabSignup) tabSignup.classList.remove("active");
      if (confirmPasswordWrap) confirmPasswordWrap.style.display = "none";
      if (passwordStrengthWrap) passwordStrengthWrap.style.display = "none";
      if (welcomeSub)
        welcomeSub.innerText =
          "Log in to your existing AUR28 wallet account on this computer.";
      if (welcomeButton) welcomeButton.innerText = "Continue";
      if (welcomeHint)
        welcomeHint.innerText =
          "Login uses your email and password. Email OTP will be added later for extra security.";
      if (forgotLink) forgotLink.style.display = "inline-block";
    }
  }

  if (tabSignup && tabLogin) {
    tabSignup.onclick = () => setMode("signup");
    tabLogin.onclick = () => setMode("login");
  }

  if (forgotLink) {
    forgotLink.onclick = () => {
      if (authMode !== "login") return;
      forgotMode = true;
      if (welcomeSub)
        welcomeSub.innerText =
          "Enter your email to request a password reset. In live mode, a reset email will be sent.";
      if (welcomeButton) welcomeButton.innerText = "Request reset (demo)";
      if (welcomeHint)
        welcomeHint.innerText =
          "Demo mode: no real reset is sent. This just closes the dialog so you can view the wallet.";
    };
  }

  async function sendOtpCode(email) {
    const url = buildUrl("/public/auth/send-code");
    const resp = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    });
    if (!resp.ok) {
      const t = await resp.text().catch(() => "");
      throw new Error(`OTP send error: HTTP ${resp.status} ${t || ""}`);
    }
    const data = await resp.json().catch(() => ({}));
    if (!data.ok) {
      throw new Error(data.error || "OTP send failed");
    }
    return data;
  }

  async function verifyOtpCode(email, code) {
    const url = buildUrl("/public/auth/verify");
    const resp = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, code }),
    });
    if (!resp.ok) {
      const t = await resp.text().catch(() => "");
      throw new Error(`Verify error: HTTP ${resp.status} ${t || ""}`);
    }
    const data = await resp.json().catch(() => ({}));
    return data;
  }

  if (
    welcomeButton &&
    welcomeOverlay &&
    welcomeEmail &&
    welcomePassword &&
    statusBox
  ) {
    welcomeButton.onclick = async () => {
      const email = (welcomeEmail.value || "").trim();
      const pw = (welcomePassword.value || "").trim();
      const pw2 = welcomePasswordConfirm
        ? (welcomePasswordConfirm.value || "").trim()
        : "";
      const otp = document.getElementById("welcome-otp")
        ? document.getElementById("welcome-otp").value.trim()
        : "";

      if (!email) {
        statusBox.innerText = "Please enter your email address.";
        return;
      }

      if (authMode === "signup") {
        // STEP 1: send code
        if (signupStep === "collect") {
          if (!pw || !pw2) {
            statusBox.innerText = "Please enter and confirm your password.";
            return;
          }
          if (pw !== pw2) {
            statusBox.innerText = "Passwords do not match. Please check again.";
            return;
          }
          try {
            statusBox.innerText = "Sending verification code to your email‚Ä¶";
            if (welcomeHint)
              welcomeHint.innerText =
                "Please wait a moment while we send the code.";
            await sendOtpCode(email);
            signupStep = "code-sent";
            if (otpRow) otpRow.style.display = "block";
            if (welcomeSub)
              welcomeSub.innerText =
                "We sent a 6-digit verification code to your email. Enter it below to continue.";
            if (welcomeButton) welcomeButton.innerText = "Verify & continue";
            if (welcomeHint)
              welcomeHint.innerText =
                "Check the inbox (and spam folder) for your AUR28 code from info@aurum28.org.";
            statusBox.innerText =
              "Verification code sent. Please enter the 6-digit code.";
          } catch (err) {
            statusBox.innerText =
              "Error sending verification code: " + err.message;
          }
          return;
        }

        // STEP 2: verify code & complete signup
        if (signupStep === "code-sent") {
          if (!otp) {
            statusBox.innerText =
              "Please enter the 6-digit code you received by email.";
            return;
          }
          try {
            statusBox.innerText = "Verifying your code‚Ä¶";
            const res = await verifyOtpCode(email, otp);
            if (!res.ok) {
              statusBox.innerText =
                "Invalid or expired code. Please request a new one.";
              return;
            }

            // Here you would also talk to your real auth server (create user).
            // For now, we simulate a local success and store a demo token.
            authToken = "demo-token";
            currentEmail = email;
            try {
              localStorage.setItem("token", authToken);
              localStorage.setItem("aur28_last_email", currentEmail);
            } catch (e) {}
            welcomeOverlay.style.display = "none";
            statusBox.innerText =
              "Email verified and account created as " +
              email +
              '. Click "Generate" to request your AUR28 address.';
            if (accountEmailInput) accountEmailInput.value = email;
            applyUserMeta();
          } catch (err) {
            statusBox.innerText = "Verification failed: " + err.message;
          }
          return;
        }
      }

      if (authMode === "login") {
        if (forgotMode) {
          welcomeOverlay.style.display = "none";
          statusBox.innerText =
            "Password reset requested (demo) for " +
            email +
            ". In live mode, an email would be sent.";
          if (accountEmailInput) accountEmailInput.value = email;
          currentEmail = email;
          try {
            localStorage.setItem("aur28_last_email", currentEmail);
          } catch (e) {}
          applyUserMeta();
          return;
        }
        if (!pw) {
          statusBox.innerText = "Please enter your password.";
          return;
        }
        // Demo login: in real version, should call real login API
        authToken = "demo-token";
        currentEmail = email;
        try {
          localStorage.setItem("token", authToken);
          localStorage.setItem("aur28_last_email", currentEmail);
        } catch (e) {}
        welcomeOverlay.style.display = "none";
        statusBox.innerText =
          "Logged in (demo) as " +
          email +
          '. You can now click "Generate" to request an AUR28 address.';
        if (accountEmailInput) accountEmailInput.value = email;
        applyUserMeta();
      }
    };
  }

  // BUTTONS
  const copyBtn = document.getElementById("copy-address");
  if (copyBtn) {
    copyBtn.onclick = () => {
      const addr =
        activeAddress ||
        (mainAddressEl ? mainAddressEl.innerText.trim() : "");
      if (!addr || addr.startsWith("No address")) {
        statusBox.innerText = "No address available to copy yet.";
        return;
      }
      navigator.clipboard.writeText(addr).then(() => {
        statusBox.innerText = "Address copied to clipboard.";
      });
    };
  }

  const genBtn = document.getElementById("generate-address");
  if (genBtn) {
    genBtn.onclick = async () => {
      if (!authToken) {
        statusBox.innerText = "Please sign up or log in first.";
        return;
      }
      await ensureAddress();
    };
  }

  const sendBtn = document.getElementById("send-btn");
  if (sendBtn) {
    sendBtn.onclick = () => {
      statusBox.innerText =
        "Send is not connected yet. In the next steps this will talk to your AUR28 server API (for example /admin/wallet/send).";
    };
  }

  // Auto-load wallet on window load (will show 2.1 pending if mempool_in=2.1)
  window.addEventListener("load", () => {
    loadWallet();
  });

  // SECURITY CODE + API TOKEN HANDLERS
  const secGenerateBtn = document.getElementById("sec-generate");
  const secCopyBtn = document.getElementById("sec-copy");
  const tokenGenerateBtn = document.getElementById("token-generate");
  const tokenCopyBtn = document.getElementById("token-copy");

  if (secGenerateBtn) {
    secGenerateBtn.onclick = () => {
      if (!currentEmail) {
        statusBox.innerText = "Please log in first to create your security code.";
        return;
      }
      const code = randomDigits(8);
      if (!userMeta[currentEmail]) userMeta[currentEmail] = {};
      userMeta[currentEmail].secCode = code;
      saveUserMeta();
      applyUserMeta();
      statusBox.innerText =
        "New wallet security code created. Store it safely for future market / API connections.";
    };
  }

  if (secCopyBtn) {
    secCopyBtn.onclick = () => {
      if (!accountSecInput || !accountSecInput.value) {
        statusBox.innerText = "No security code to copy yet.";
        return;
      }
      navigator.clipboard.writeText(accountSecInput.value).then(() => {
        statusBox.innerText = "Security code copied.";
      });
    };
  }

  if (tokenGenerateBtn) {
    tokenGenerateBtn.onclick = () => {
      if (!currentEmail) {
        statusBox.innerText = "Please log in first to create your API token.";
        return;
      }
      const token = "AUR28-" + randomHex(32);
      if (!userMeta[currentEmail]) userMeta[currentEmail] = {};
      userMeta[currentEmail].apiToken = token;
      saveUserMeta();
      applyUserMeta();
      statusBox.innerText =
        "New API token created. Use this later to connect external apps or markets to your wallet.";
    };
  }

  if (tokenCopyBtn) {
    tokenCopyBtn.onclick = () => {
      if (!accountTokenInput || !accountTokenInput.value) {
        statusBox.innerText = "No API token to copy yet.";
        return;
      }
      navigator.clipboard.writeText(accountTokenInput.value).then(() => {
        statusBox.innerText = "API token copied.";
      });
    };
  }

  // LOGOUT (TOP + ACCOUNT)
  const logoutBtn = document.getElementById("logout-btn");
  const logoutTopBtn = document.getElementById("logout-top-btn");

  function doLogout() {
    authToken = null;
    currentEmail = null;
    try {
      localStorage.removeItem("token");
      localStorage.removeItem("aur28_last_email");
    } catch (e) {}
    if (accountEmailInput) accountEmailInput.value = "";
    if (welcomeOverlay) welcomeOverlay.style.display = "flex";
    if (statusBox) {
      statusBox.innerText =
        "Logged out from this device. Please sign up or log in to access your wallet again.";
    }
  }

  if (logoutBtn) logoutBtn.onclick = doLogout;
  if (logoutTopBtn) logoutTopBtn.onclick = doLogout;

  // SETTINGS & SERVER STATUS
  const settingsBtn = document.getElementById("settings-btn");
  const settingsBackdrop = document.getElementById("settings-backdrop");
  const settingsClose = document.getElementById("settings-close");
  const chips = document.querySelectorAll(".set-chip");
  const deviceInfo = document.getElementById("device-info");
  const serverInfo = document.getElementById("server-info");
  const langCurrent = document.getElementById("lang-current");

  function openSettings() {
    if (settingsBackdrop) settingsBackdrop.classList.add("open");
  }
  function closeSettings() {
    if (settingsBackdrop) settingsBackdrop.classList.remove("open");
  }

  if (settingsBtn) settingsBtn.addEventListener("click", openSettings);
  if (settingsClose) settingsClose.addEventListener("click", closeSettings);
  if (settingsBackdrop) {
    settingsBackdrop.addEventListener("click", (e) => {
      if (e.target === settingsBackdrop) closeSettings();
    });
  }

  function applyTheme(theme) {
    document.body.classList.remove("theme-dark", "theme-light");
    const current = theme || "light";
    if (current === "light") {
      document.body.classList.add("theme-light");
    } else if (current === "auto") {
      if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: light)").matches
      ) {
        document.body.classList.add("theme-light");
      } else {
        document.body.classList.add("theme-dark");
      }
    } else {
      document.body.classList.add("theme-dark");
    }
  }

  function applyTextSize(size) {
    document.body.style.fontSize =
      size === "small" ? "13px" : size === "large" ? "16px" : "14px";
  }

  function setActiveChip(group, value) {
    chips.forEach((chip) => {
      if (chip.dataset.group === group) {
        chip.classList.toggle("active", chip.dataset.value === value);
      }
    });
  }

  const savedTheme = localStorage.getItem("aur_theme") || "light";
  const savedLang = localStorage.getItem("aur_lang") || "en";
  const savedText = localStorage.getItem("aur_text") || "default";
  let currentLang = savedLang;

  const langLabels = {
    en: "English",
    ka: "·É•·Éê·É†·Éó·É£·Éö·Éò",
    tr: "T√ºrk√ße",
    ja: "Êó•Êú¨Ë™û",
  };

  applyTheme(savedTheme);
  applyTextSize(savedText);
  setActiveChip("theme", savedTheme);
  setActiveChip("text", savedText);
  setActiveChip("lang", currentLang);

  if (langCurrent) {
    langCurrent.textContent = langLabels[currentLang] || "English";
  }

  // Views
  const views = {
    wallet: document.getElementById("view-wallet"),
    account: document.getElementById("view-account"),
    market: document.getElementById("view-market"),
    contact: document.getElementById("view-contact"),
  };
  let currentSection = "wallet";

  const topSubtitle = document.getElementById("top-subtitle");
  const sidebarSubtitle = document.querySelector(".sidebar-subtitle");
  const topTitle = document.querySelector(".top-title");

  // Language text map
  const subtitleMap = {
    en: {
      wallet: "My wallet",
      account: "Account & security",
      market: "Market preview",
      contact: "Support & contact",
      settings: "Wallet settings",
      desktop: "Desktop wallet",
      contactTitle: "Contact admin",
      nameLabel: "Your name",
      emailLabel: "Email",
      messageLabel: "Message",
      sendButton: "Send to admin (not connected)",
      accountTitle: "Account & security",
      aurMarketTitle: "AUR28 market preview",
      globalMarketTitle: "Global crypto market",
    },
    ja: {
      wallet: "„Éû„Ç§„Ç¶„Ç©„É¨„ÉÉ„Éà",
      account: "„Ç¢„Ç´„Ç¶„É≥„Éà & „Çª„Ç≠„É•„É™„ÉÜ„Ç£",
      market: "„Éû„Éº„Ç±„ÉÉ„Éà„Éó„É¨„Éì„É•„Éº",
      contact: "ÁÆ°ÁêÜËÄÖ„Å´ÈÄ£Áµ°",
      settings: "„Ç¶„Ç©„É¨„ÉÉ„ÉàË®≠ÂÆö",
      desktop: "„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Ç¶„Ç©„É¨„ÉÉ„Éà",
      contactTitle: "ÁÆ°ÁêÜËÄÖ„Å´ÈÄ£Áµ°",
      nameLabel: "„ÅäÂêçÂâç",
      emailLabel: "„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ",
      messageLabel: "„É°„ÉÉ„Çª„Éº„Ç∏",
      sendButton: "ÁÆ°ÁêÜËÄÖ„Å´ÈÄÅ‰ø° (Êú™Êé•Á∂ö)",
      accountTitle: "„Ç¢„Ç´„Ç¶„É≥„Éà & „Çª„Ç≠„É•„É™„ÉÜ„Ç£",
      aurMarketTitle: "AUR28 „Éû„Éº„Ç±„ÉÉ„Éà„Éó„É¨„Éì„É•„Éº",
      globalMarketTitle: "„Ç∞„É≠„Éº„Éê„É´ÊöóÂè∑ÈÄöË≤®Â∏ÇÂ†¥",
    },
    ka: {
      wallet: "·É©·Éî·Éõ·Éò ·É°·Éê·É§·É£·Éö·Éî",
      account: "·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò ·Éì·Éê ·É£·É°·Éê·É§·É†·Éó·ÉÆ·Éù·Éî·Éë·Éê",
      market: "·Éë·Éê·Éñ·É†·Éò·É° ·Éû·É†·Éò·Éï·Éò·É£",
      contact: "·Éô·Éù·Éú·É¢·Éê·É•·É¢·Éò ·Éê·Éì·Éõ·Éò·Éú·Éó·Éê·Éú",
      settings: "·É°·Éê·É§·É£·Éö·Éò·É° ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò",
      desktop: "·Éì·Éî·É°·Éô·É¢·Éù·Éû ·É°·Éê·É§·É£·Éö·Éî",
      contactTitle: "·Éô·Éù·Éú·É¢·Éê·É•·É¢·Éò ·Éê·Éì·Éõ·Éò·Éú·Éó·Éê·Éú",
      nameLabel: "·Éó·É•·Éï·Éî·Éú·Éò ·É°·Éê·ÉÆ·Éî·Éö·Éò",
      emailLabel: "·Éî·Éö. ·É§·Éù·É°·É¢·Éê",
      messageLabel: "·É®·Éî·É¢·Éß·Éù·Éë·Éò·Éú·Éî·Éë·Éê",
      sendButton: "·Éí·Éê·Éí·Éñ·Éê·Éï·Éú·Éê ·Éê·Éì·Éõ·Éò·Éú·Éó·Éê·Éú (·Éê·É† ·Éê·É†·Éò·É° ·Éì·Éê·Éô·Éê·Éï·É®·Éò·É†·Éî·Éë·É£·Éö·Éò)",
      accountTitle: "·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò ·Éì·Éê ·É£·É°·Éê·É§·É†·Éó·ÉÆ·Éù·Éî·Éë·Éê",
      aurMarketTitle: "AUR28 ·Éë·Éê·Éñ·É†·Éò·É° ·Éû·É†·Éò·Éï·Éò·É£",
      globalMarketTitle: "·Éí·Éö·Éù·Éë·Éê·Éö·É£·É†·Éò ·Éô·É†·Éò·Éû·É¢·Éù ·Éë·Éê·Éñ·Éê·É†·Éò",
    },
    tr: {
      wallet: "C√ºzdanƒ±m",
      account: "Hesap ve g√ºvenlik",
      market: "Piyasa √∂nizleme",
      contact: "Y√∂neticiyle ileti≈üim",
      settings: "C√ºzdan ayarlarƒ±",
      desktop: "Masa√ºst√º c√ºzdan",
      contactTitle: "Y√∂neticiyle ileti≈üim",
      nameLabel: "Adƒ±nƒ±z",
      emailLabel: "E-posta",
      messageLabel: "Mesaj",
      sendButton: "Y√∂neticiye g√∂nder (baƒülƒ± deƒüil)",
      accountTitle: "Hesap ve g√ºvenlik",
      aurMarketTitle: "AUR28 piyasa √∂nizleme",
      globalMarketTitle: "Global kripto piyasasƒ±",
    },
  };

  function showSection(section) {
    currentSection = section;
    Object.keys(views).forEach((key) => {
      if (views[key]) {
        views[key].classList.toggle("hidden", key !== section);
      }
    });

    const langKey = subtitleMap[currentLang] ? currentLang : "en";
    const map = subtitleMap[langKey];
    if (topSubtitle) {
      topSubtitle.textContent = map[section] || map.wallet;
    }
  }

  function updateLanguageUI() {
    const langKey = subtitleMap[currentLang] ? currentLang : "en";
    const map = subtitleMap[langKey];

    if (sidebarSubtitle) {
      sidebarSubtitle.textContent = map.desktop;
    }
    if (topTitle) {
      topTitle.textContent = "AUR28 Wallet";
    }

    const walletItemLabel = document.querySelector(
      '.menu-item[data-section="wallet"] span:last-child'
    );
    if (walletItemLabel) walletItemLabel.textContent = map.wallet;

    const accountItemLabel = document.querySelector(
      '.menu-item[data-section="account"] span:last-child'
    );
    if (accountItemLabel) accountItemLabel.textContent = map.account;

    const marketItemLabel = document.querySelector(
      '.menu-item[data-section="market"] span:last-child'
    );
    if (marketItemLabel)
      marketItemLabel.textContent = map.market;

    const contactItemLabel = document.querySelector(
      '.menu-item[data-section="contact"] span:last-child'
    );
    if (contactItemLabel)
      contactItemLabel.textContent = map.contact;

    const settingsItemLabel = document.querySelector(
      '.menu-item[data-section="settings"] span:last-child'
    );
    if (settingsItemLabel) settingsItemLabel.textContent = map.settings;

    // Contact form labels
    const contactTitle = document.getElementById("contact-title");
    const contactNameLabel = document.getElementById("contact-name-label");
    const contactEmailLabel = document.getElementById("contact-email-label");
    const contactMessageLabel = document.getElementById("contact-message-label");
    const contactSendBtn = document.getElementById("contact-send");
    if (contactTitle)
      contactTitle.textContent = map.contactTitle;
    if (contactNameLabel)
      contactNameLabel.textContent = map.nameLabel;
    if (contactEmailLabel)
      contactEmailLabel.textContent = map.emailLabel;
    if (contactMessageLabel)
      contactMessageLabel.textContent = map.messageLabel;
    if (contactSendBtn)
      contactSendBtn.textContent = map.sendButton;

    // Account title
    const accountTitle = document.getElementById("account-title");
    if (accountTitle)
      accountTitle.textContent = map.accountTitle;

    // Market titles
    const aur28MarketTitle = document.getElementById("aur28-market-title");
    const globalMarketTitle = document.getElementById("global-market-title");
    if (aur28MarketTitle)
      aur28MarketTitle.textContent = map.aurMarketTitle;
    if (globalMarketTitle)
      globalMarketTitle.textContent = map.globalMarketTitle;

    // Update subtitle text for current section
    showSection(currentSection);
  }

  // Initial language UI
  updateLanguageUI();

  // Device info
  if (deviceInfo) {
    try {
      const ua = navigator.userAgent || "";
      const w = window.screen?.width || "-";
      const h = window.screen?.height || "-";
      deviceInfo.textContent =
        "Device: " + ua + " ‚Ä¢ Screen: " + w + " x " + h + "px";
    } catch (e) {
      deviceInfo.textContent = "Device information not available.";
    }
  }

  // Check /public/ping with plain fetch (no auth) to avoid CORS issues
  async function checkServer() {
    if (serverInfo) serverInfo.textContent = "Checking connection‚Ä¶";
    const started = performance.now();
    try {
      const url = buildUrl("/public/ping");
      const resp = await fetch(url, { method: "GET" });
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const latency = Math.round(performance.now() - started);
      if (serverInfo) {
        serverInfo.textContent =
          "Online ‚Ä¢ " + latency + " ms ‚Ä¢ " + url;
      }
    } catch (err) {
      if (serverInfo) {
        serverInfo.textContent =
          "Cannot reach /public/ping. Check node, API service and Nginx routing.";
      }
    }
  }

  checkServer();
  setInterval(checkServer, 15000);

  // Settings chips (theme, language, text size)
  chips.forEach((chip) => {
    chip.addEventListener("click", () => {
      const group = chip.dataset.group;
      const value = chip.dataset.value;

      if (group === "theme") {
        localStorage.setItem("aur_theme", value);
        applyTheme(value);
      } else if (group === "lang") {
        currentLang = value;
        localStorage.setItem("aur_lang", value);
        if (langCurrent) {
          langCurrent.textContent = langLabels[value] || value;
        }
        updateLanguageUI();
      } else if (group === "text") {
        localStorage.setItem("aur_text", value);
        applyTextSize(value);
      }
      setActiveChip(group, value);
    });
  });

  if (window.matchMedia) {
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", () => {
        const current = localStorage.getItem("aur_theme") || "light";
        if (current === "auto") applyTheme("auto");
      });
  }

  // SIDEBAR MENU
  const menuItems = document.querySelectorAll(".menu-item");

  menuItems.forEach((item) => {
    item.addEventListener("click", () => {
      const section = item.dataset.section;
      menuItems.forEach((m) => m.classList.remove("active"));
      item.classList.add("active");

      if (section === "settings") {
        openSettings();
      } else {
        showSection(section);
      }

      if (section === "contact") {
        statusBox.innerText =
          "Support view open. Use the form to send a message to the admin (demo mode).";
      } else if (section === "market") {
        statusBox.innerText =
          "Market preview will show AUR28 markets here after listing.";
      } else if (section === "wallet") {
        statusBox.innerText =
          "My wallet view. Click ‚ÄúGenerate‚Äù to create or load your AUR28 address.";
      } else if (section === "account") {
        statusBox.innerText =
          "Account view: here you manage your security code and API token for future market connections.";
      }

      // Re-apply language text for subtitle etc.
      updateLanguageUI();
    });
  });

  // CONTACT FORM
  const contactSendBtn = document.getElementById("contact-send");
  const contactStatus = document.getElementById("contact-status");
  if (contactSendBtn && contactStatus) {
    contactSendBtn.onclick = () => {
      contactStatus.textContent =
        "Demo mode: this would send your message to the AUR28 admin dashboard.";
    };
  }

  // GLOBAL CRYPTO MARKET (BTC / ETH / XRP + AUR28 preview)
  const marketRowsEl = document.getElementById("market-rows");
  const marketStatusEl = document.getElementById("market-status");
  const marketLastUpdateEl = document.getElementById("market-last-update");

  async function fetchGlobalMarket() {
    if (!marketRowsEl || !marketStatusEl) return;
    marketStatusEl.textContent = "Updating live prices‚Ä¶";

    try {
      const url =
        "https://api.coingecko.com/api/v3/simple/price" +
        "?ids=bitcoin,ethereum,ripple&vs_currencies=usd&include_24hr_change=true";
      const resp = await fetch(url);
      if (!resp.ok) {
        throw new Error("HTTP " + resp.status);
      }
      const data = await resp.json();

      const coins = [
        { id: "bitcoin", symbol: "BTC", name: "Bitcoin" },
        { id: "ethereum", symbol: "ETH", name: "Ethereum" },
        { id: "ripple", symbol: "XRP", name: "XRP" },
      ];

      marketRowsEl.innerHTML = "";

      coins.forEach((coin) => {
        const obj = data[coin.id] || {};
        const price = typeof obj.usd === "number" ? obj.usd : null;
        const change =
          typeof obj.usd_24h_change === "number"
            ? obj.usd_24h_change
            : null;

        const row = document.createElement("div");
        row.className = "market-row";

        const left = document.createElement("div");
        left.className = "market-left";

        const badge = document.createElement("div");
        badge.className = "market-badge";
        badge.textContent = coin.symbol[0];

        const nameBlock = document.createElement("div");
        const symSpan = document.createElement("div");
        symSpan.className = "market-symbol";
        symSpan.textContent = coin.symbol;
        const nameSpan = document.createElement("div");
        nameSpan.className = "market-name";
        nameSpan.textContent = coin.name;
        nameBlock.appendChild(symSpan);
        nameBlock.appendChild(nameSpan);

        left.appendChild(badge);
        left.appendChild(nameBlock);

        const right = document.createElement("div");
        right.className = "market-right";

        const priceDiv = document.createElement("div");
        priceDiv.className = "market-price";
        priceDiv.textContent =
          price != null
            ? "$" +
              price.toLocaleString(undefined, {
                maximumFractionDigits: 2,
              })
            : "-";

        const changeDiv = document.createElement("div");
        changeDiv.className = "market-change";
        if (change == null) {
          changeDiv.textContent = "24h: -";
          changeDiv.classList.add("flat");
        } else {
          const rounded = change.toFixed(2);
          changeDiv.textContent =
            "24h: " + (rounded > 0 ? "+" : "") + rounded + "%";
          if (rounded > 0) changeDiv.classList.add("pos");
          else if (rounded < 0) changeDiv.classList.add("neg");
          else changeDiv.classList.add("flat");
        }

        right.appendChild(priceDiv);
        right.appendChild(changeDiv);

        row.appendChild(left);
        row.appendChild(right);

        marketRowsEl.appendChild(row);
      });

      // AUR28 static preview
      const aurRow = document.createElement("div");
      aurRow.className = "market-row";

      const aurLeft = document.createElement("div");
      aurLeft.className = "market-left";
      const aurBadge = document.createElement("div");
      aurBadge.className = "market-badge";
      aurBadge.textContent = "A";
      const aurNameBlock = document.createElement("div");
      const aurSym = document.createElement("div");
      aurSym.className = "market-symbol";
      aurSym.textContent = "AUR28";
      const aurName = document.createElement("div");
      aurName.className = "market-name";
      aurName.textContent = "Aurum28 (preview)";
      aurNameBlock.appendChild(aurSym);
      aurNameBlock.appendChild(aurName);
      aurLeft.appendChild(aurBadge);
      aurLeft.appendChild(aurNameBlock);

      const aurRight = document.createElement("div");
      aurRight.className = "market-right";
      const aurPrice = document.createElement("div");
      aurPrice.className = "market-price";
      aurPrice.textContent = "$2.30 (fixed)";
      const aurChange = document.createElement("div");
      aurChange.className = "market-change flat";
      aurChange.textContent = "Pre-listing preview";
      aurRight.appendChild(aurPrice);
      aurRight.appendChild(aurChange);

      aurRow.appendChild(aurLeft);
      aurRow.appendChild(aurRight);
      marketRowsEl.appendChild(aurRow);

      marketStatusEl.textContent =
        "Prices from public market API (CoinGecko). AUR28 is manual preview.";
      if (marketLastUpdateEl) {
        const now = new Date();
        marketLastUpdateEl.textContent =
          "Updated " +
          now.getHours().toString().padStart(2, "0") +
          ":" +
          now.getMinutes().toString().padStart(2, "0");
      }
    } catch (err) {
      marketStatusEl.textContent =
        "Unable to load live market data (API / internet / CORS issue). AUR28 price is still shown as preview.";
      if (marketLastUpdateEl) {
        marketLastUpdateEl.textContent = "Update failed";
      }
    }
  }

  fetchGlobalMarket();
  setInterval(fetchGlobalMarket, 60000);

  // CUSTOM CONTEXT MENU (RIGHT CLICK COPY/PASTE)
  const contextMenu = document.getElementById("context-menu");
  let contextTarget = null;

  function hideContextMenu() {
    if (contextMenu) {
      contextMenu.style.display = "none";
    }
    contextTarget = null;
  }

  document.addEventListener("contextmenu", (e) => {
    const target = e.target.closest("input, textarea, .address-box");
    if (!target || !contextMenu) return;
    e.preventDefault();
    contextTarget = target;

    const x = e.clientX;
    const y = e.clientY;
    contextMenu.style.left = x + "px";
    contextMenu.style.top = y + "px";
    contextMenu.style.display = "block";
  });

  document.addEventListener("click", (e) => {
    if (contextMenu && !contextMenu.contains(e.target)) {
      hideContextMenu();
    }
  });

  if (contextMenu) {
    contextMenu.addEventListener("click", async (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn || !contextTarget) return;
      const action = btn.dataset.action;
      const isInput =
        contextTarget.tagName === "INPUT" || contextTarget.tagName === "TEXTAREA";

      if (action === "copy") {
        const text = isInput
          ? contextTarget.value
          : (contextTarget.innerText || "");
        if (text) {
          await navigator.clipboard.writeText(text).catch(() => {});
        }
      } else if (action === "paste") {
        try {
          const clipText = await navigator.clipboard.readText();
          if (isInput) {
            const start = contextTarget.selectionStart ?? contextTarget.value.length;
            const end = contextTarget.selectionEnd ?? contextTarget.value.length;
            const v = contextTarget.value;
            contextTarget.value = v.slice(0, start) + clipText + v.slice(end);
          }
        } catch (err) {
          // ignore
        }
      } else if (action === "select-all") {
        if (isInput) {
          contextTarget.select();
        }
      }
      hideContextMenu();
    });
  }
</script>

</body>
</html>

